<DOCTYPE! html>
<html>

<head>
  <title>color test</title>
  <META charset="UTF-8">
  <META name="viewport" content="width=device-width, initial-scale=1.0">
  <META http-equiv="X-UA-Compatible" content="IE=Edge" />
  <META
    name="description"
    content="This page does not exist"
  >
  <META
    name="keywords"
    content="god, sex, power, the, love, wealth, happiness"
  >

  <style type="text/css">
    a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}
  </style>

</head>

<body>
  <div style="
    width: 200px;
    height: 200px;
    background-color: black;
  " id="box">Some Text!</div>


  <script>
    function dynamicInterval(fn) {
      let now = Date.now();
      let interval, timeout;
      let intervals = 0

      const runFn = (arg) => {
        now = Date.now();
        fn(arg);
      };

      const set = (time, arg) => {
        const timeElapsed = Date.now() - now;
        const timeLeft = Math.round(time - timeElapsed)

        clearTimeout(timeout);
        timeout = setTimeout(
          () => {
            runFn(arg);
            clearInterval(interval);
            interval = setInterval(
              () => runFn(arg),
              Math.round(time)
            );
          },
          Math.max(timeLeft, 0)
        );
      }

      return {
        set,
        clear() {
          clearInterval(interval);
          clearTimeout(timeOut);
        }
      }
    }

    function onMouseMove(fn) {
      document.onmousemove = (e) => {
        const x = e.clientX + window.pageXOffset;
        const y = e.clientY + window.pageYOffset;
        fn({x, y});
      };
    }

    const targetDist = (mouseCoords, target) => {
      const xDiff = Math.abs(mouseCoords.x - target.x);
      const yDiff = Math.abs(mouseCoords.y - target.y);
      return Math.sqrt((xDiff ** 2) + (yDiff ** 2));
    };


    const box = document.getElementById('box');
    let color = '#ff0000';
    let inverseColor = applyToHex(color, {h:180});
    let colorDist = 1
    const { set, clear } = dynamicInterval((time) => {
      color = applyToHex(color, {h:colorDist})
      inverseColor = applyToHex(color, {h:180});
      console.log(color, colorDist/time)
      box.style['background-color'] = color;
      box.style['color'] = inverseColor;
    })

    set(20, 20)
    onMouseMove((coords) => {
      const distance = targetDist(coords, {x:100, y:100});
      const time = 50 * (distance/700);
      colorDist = Math.max(
        1, Math.floor(
          5 * (1 - time)
        )
      );
      set(time, time)
    });








    //// COLOR SHIT

function applyToHex(hex, {h=0, s=0, v=0} = {}, mod=1) {
  function numToHex(num) {
    let hex = Math.round( Math.min(num, 255) ).toString(16);
    return (hex.length === 1 ? '0' + hex : hex).toUpperCase();
  }

  const hexToNum = (hex) => parseInt(hex, 16);

  const rgbToHex = ({r, g, b}) =>
    '#' + numToHex(r) + numToHex(g) + numToHex(b);

  const hexToRgb = (hex) => hex.length === 7 ? {
      r: hexToNum( hex.slice(1, 3) ),
      g: hexToNum( hex.slice(3, 5) ),
      b: hexToNum( hex.slice(5, 7) )
    } : {
      r: hexToNum( hex.slice(1, 2).repeat(2) ),
      g: hexToNum( hex.slice(2, 3).repeat(2) ),
      b: hexToNum( hex.slice(3, 4).repeat(2) )
    };

  const round = (n, decimals=0) => +n.toFixed(decimals);

  // http://www.rapidtables.com/convert/color/rgb-to-hsv.htm
  function rgbToHsv({r, g, b}) {
    r /= 255;
    g /= 255;
    b /= 255;

    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    const diff = max - min;
    const value = max;
    const saturation = max ? diff / max : 0;

    let hue;
    if (!diff) {
      hue = 0;

    // For some reason website says "mod 6". This returns wonky
    // values, while + 6 appears to return the correct values.
    } else if (r === max) {
      hue = ((g - b) / diff) + 6;

    } else if (g === max) {
      hue = ((b - r) / diff) + 2;

    } else if (b === max) {
      hue = ((r - g) / diff) + 4;
    }

    hue *= 60;

    return {
      h: (hue === 360) ? 0 : hue,
      s: round(saturation, 2),
      v: round(value, 2)
    };
  }

  function hsvToRgb({h, s, v}) {
    h /= 60;
    const c = v * s;
    const x = c * (1 - Math.abs(h % 2 - 1));
    const m = v - c;

    let r, g, b;
    switch (Math.floor(h)) {
      case 0:
      case 6:
        r = c; g = x; b = 0; break;
      case 1:
        r = x; g = c; b = 0; break;
      case 2:
        r = 0; g = c; b = x; break;
      case 3:
        r = 0; g = x; b = c; break;
      case 4:
        r = x; g = 0; b = c; break;
      case 5:
        r = c; g = 0; b = x; break;
    }

    return {
      r: round((r + m) * 255),
      g: round((g + m) * 255),
      b: round((b + m) * 255)
    };
  }

  const hexToHsv = (hex) => rgbToHsv( hexToRgb(hex) );
  const hsvToHex = (hsv) => rgbToHex( hsvToRgb(hsv) );

  const wrap = (number, max) => (
    number >= max ? wrap(number - max, max) :
    number < 0    ? wrap(max + number, max) :
    number
  );

  const between = (n, max, min) => Math.max(
    Math.min(n, max),
    min
  );
  let hsv = hexToHsv(hex);
  return hsvToHex({
    h:    wrap(hsv.h + (h / mod), 360),
    s: between(hsv.s + (s / mod), 1, 0),
    v: between(hsv.v + (v / mod), 1, 0)
  });
}

const randMax = (ceil) => Math.floor(
  Math.random() * ceil
);

function randHex() {
  let color = '#';
  for (let i = 0; i < 6; i++) {
    color += randMax(16).toString(16);
  }
  return color.toUpperCase();
}
  </script>
</body>

</html>
